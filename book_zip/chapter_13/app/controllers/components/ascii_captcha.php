<?php
class AsciiCaptchaComponent extends Object {

    var $noise_chars = array( ' ', "=", "-", ":" );
    var $ascii_fonts = array();

	function startup(&$controller) {
		$this->data = $controller->data;
    }

	function initialize() {
				$fonts['A'] = 
"   @@@    
  @@-@@   
 @@---@@  
@@-- --@@ 
@@@@@@@@@ 
@@- ---@@ 
@@-----@@ ";
				$fonts['B'] = 
"@@@@@@@@  
@@-----@@ 
@@--- -@@ 
@@@@@@@@  
@@-----@@ 
@@- ---@@ 
@@@@@@@@  ";
				$fonts['C'] = 
" @@@@@@  
@@-- -@@ 
@@       
@@       
@@       
@@----@@ 
 @@@@@@  ";
 				$fonts['D'] = 
"@@@@@@@@  
@@-----@@ 
@@- ---@@ 
@@-----@@ 
@@-----@@ 
@@--- -@@ 
@@@@@@@@  ";
				$fonts['E'] = 
"@@@@@@@@ 
@@       
@@       
@@@@@@   
@@       
@@       
@@@@@@@@ ";
				$fonts['F'] = 
"@@@@@@@@ 
@@       
@@       
@@@@@@   
@@       
@@       
@@       ";
				$fonts['G'] = 
" @@@@@@   
@@- --@@  
@@        
@@---@@@@ 
@@ ---@@  
@@----@@  
 @@@@@@   ";
				$fonts['H'] = 
"@@-----@@ 
@@-- --@@ 
@@-----@@ 
@@@@@@@@@ 
@@- ---@@ 
@@-----@@ 
@@-- --@@ ";
				$fonts['I'] = 
"@@@@ 
 @@  
 @@  
 @@  
 @@  
 @@  
@@@@ ";
				$fonts['J'] = 
"     @@ 
      @@ 
      @@ 
      @@ 
@@----@@ 
@@----@@ 
 @@@@@@  ";
				$fonts['K'] = 
"@@- --@@ 
@@---@@  
@@--@@   
@@@@@    
@@--@@   
@@- -@@  
@@----@@ ";
				$fonts['L'] = 
"@@       
@@       
@@       
@@       
@@       
@@       
@@@@@@@@ ";
				$fonts['M'] = 
"@@- ---@@ 
@@@---@@@ 
@@@@-@@@@ 
@@-@@@-@@ 
@@- ---@@ 
@@-----@@ 
@@--- -@@ ";
				$fonts['N'] = 
"@@- --@@ 
@@@---@@ 
@@@@--@@ 
@@-@@-@@ 
@@--@@@@ 
@@- -@@@ 
@@----@@ ";
				$fonts['O'] = 
"@@@@@@@  
@@-- --@@ 
@@-----@@ 
@@-----@@ 
@@- ---@@ 
@@-----@@ 
 @@@@@@@  ";
				$fonts['P'] = 
"@@@@@@@@  
@@--- -@@ 
@@-----@@ 
@@@@@@@@  
@@        
@@        
@@        ";
				$fonts['Q'] = 
" @@@@@@@  
@@ ----@@ 
@@-----@@ 
@@--- -@@ 
@@--@@-@@ 
@@----@@  
 @@@@@-@@ ";
				$fonts['R'] = 
"@@@@@@@@  
@@- ---@@ 
@@-----@@ 
@@@@@@@@  
@@---@@   
@@- --@@  
@@-- --@@ ";
				$fonts['S'] = 
" @@@@@@  
@@- --@@ 
@@       
 @@@@@@  
      @@ 
@@- --@@ 
 @@@@@@  ";
				$fonts['T'] = 
"@@@@@@@
   @@    
   @@    
   @@    
   @@    
   @@    
   @@    ";
				$fonts['U'] = 
"@@- ---@@ 
@@-----@@ 
@@-- --@@ 
@@-----@@ 
@@- ---@@ 
@@-- --@@ 
 @@@@@@@  ";
				$fonts['V'] = 
"@@- ---@@ 
@@-----@@ 
@@- ---@@ 
@@--- -@@ 
 @@- -@@  
  @@-@@   
   @@@    ";
				$fonts['W'] = 
"@@-- ---@ 
@@--@@--@@ 
@@--@@- @@ 
@@--@@--@@ 
@@ -@@--@@ 
@@--@@--@@ 
 @@@--@@@  ";
				$fonts['X'] = 
"@@- ---@@ 
 @@---@@ 
  @@-@@   
   @@@    
  @@-@@   
 @@- -@@  
@@-----@@ ";
				$fonts['Y'] = 
"@@ ---@
 @@--@@  
  @@@@   
   @@    
   @@    
   @@    
   @@    ";
				$fonts['Z'] = 
"@@@@@@@
     @@  
    @@   
   @@    
  @@     
 @@      
@@@@@@@@ ";
				$fonts['0'] = 
"@@@@@@@  
@@- ---@@ 
@@---@-@@ 
@@--@--@@ 
@@-@- -@@ 
@@-- --@@ 
 @@@@@@@  ";
				$fonts['1'] = 
"  @@   
 @@@@   
   @@   
   @@   
   @@   
   @@   
 @@@@@@ ";
				$fonts['2'] = 
"@@@@@@@  
@@-- --@@ 
       @@ 
 @@@@@@@  
@@        
@@        
@@@@@@@@@ ";
				$fonts['3'] = 
"@@@@@@@  
@@- ---@@ 
       @@ 
 @@@@@@@  
       @@ 
@@-- --@@ 
 @@@@@@@  ";
				$fonts['4'] = 
"@@
@@- --@@  
@@----@@  
@@----@@  
@@@@@@@@@ 
      @@  
      @@  ";
				$fonts['5'] = 
"@@@@@@@
@@       
@@       
@@@@@@@  
      @@ 
@@- --@@ 
 @@@@@@  ";
				$fonts['6'] = 
"@@@@@@@  
@@-- --@@ 
@@        
@@@@@@@@  
@@- ---@@ 
@@--- -@@ 
 @@@@@@@  ";
				$fonts['7'] = 
"@@@@@@@
@@- --@@ 
    @@   
   @@    
  @@     
  @@     
  @@     ";
				$fonts['8'] = 
"@@@@@@@  
@@ ----@@ 
@@--- -@@ 
 @@@@@@@  
@@- ---@@ 
@@--- -@@ 
 @@@@@@@  ";
				$fonts['9'] = 
"@@@@@@@  
@@- ---@@ 
@@-- --@@ 
 @@@@@@@@ 
       @@ 
@@- ---@@ 
 @@@@@@@  ";	
 
		$this->ascii_fonts = $fonts;
    }
    
    
    function getCaptcha() {
    
        $result = array();
        $captcha_chars = array_rand( $this->ascii_fonts, 5 );
    	
    	for ($idx = 0; $idx < sizeof( $captcha_chars ); $idx++) {
    	   $cap_char = $captcha_chars[$idx];
    	   $result[ $cap_char ] = $this->ascii_fonts[ $cap_char ];
    	}
    	
    	$result = $this->addNoise( $result );
    	
        return $result;
    }     
    
    function addNoise( $captcha_strings ) {
    
        $result = array();
        
        foreach( $captcha_strings as $cap_char => $ascii ) {
        
            // add some random noise into white spaces
            for ($idx = 0; $idx < strlen( $ascii ); $idx++) {
            
                if ( $ascii[$idx] == ' ' ) {
                
                    // replace with white noise
                    $noise_char = array_rand( $this->noise_chars, 1 );
                    $ascii[$idx] = $this->noise_chars[$noise_char];
                }
            }
            
            // add white space between characters
            $ascii = str_replace ( chr(13), '  ', $ascii );
    	   
            $result[ $cap_char ] = $ascii;
    	}
        
        return $result;
    }

}
?>